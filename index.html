<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Cyber Clubs</title>
  <meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
/>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- ===== style.css (–ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô) ===== -->
  <style>
    body {
      margin: 0;
      background: #0b0f19;
      color: #fff;
      font-family: Inter, system-ui, sans-serif;
    }

    header {
  padding: 16px;
  position: sticky;
  top: 0;
  z-index: 500;
  background: #0b0f19;
    }

    select {
      width: 100%;
      padding: 10px;
      border-radius: 12px;
      background: #141a2b;
      color: #fff;
      border: none;
      margin-top: 8px;
    }

    #clubs {
  padding: 16px;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
    }

    .card {
  background: linear-gradient(180deg, #141a2b, #0f1322);
  border-radius: 18px;
  overflow: hidden;
  box-shadow: 0 8px 24px rgba(0,0,0,0.35);
  transition: transform .2s ease, box-shadow .2s ease;
  display: flex;
  flex-direction: column;
    }

    /* üëâ –ö–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ –∑–æ–Ω—ã */
.zone-item {
  position: relative;
  cursor: pointer;
  transition: transform .15s ease, background .15s ease;
}

.zone-item:active {
  transform: scale(0.97);
  background: #222a44 !important;
}

/* —Å—Ç—Ä–µ–ª–∫–∞ —Å–ø—Ä–∞–≤–∞ */
.zone-item::after {
  content: "‚Ä∫";
  position: absolute;
  right: 14px;
  font-size: 22px;
  opacity: 0.5;
}
    
    .card:active {
  transform: scale(0.98);
  box-shadow: 0 4px 14px rgba(0,0,0,0.25);
    }

    .card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
    }

    .card h2 {
  margin: 12px;
  font-size: 16px;
  font-weight: 600;
  line-height: 1.2;
    }

    .card button {
  margin: 12px;
  margin-top: auto;
  padding: 13px;
  width: calc(100% - 24px);
  border: none;
  border-radius: 14px;
  background: linear-gradient(135deg, #00e5ff, #00bcd4);
  color: #001418;
  font-weight: 700;
  font-size: 14px;
    }

    /* ===== Skeleton ===== */
.skeleton {
  background: #141a2b;
  border-radius: 18px;
  overflow: hidden;
  display: flex;
flex-direction: column;
height: 100%;
}

.skeleton-img {
  height: 140px;
  background: linear-gradient(
    90deg,
    #1a2033 25%,
    #222a44 37%,
    #1a2033 63%
  );
  background-size: 400% 100%;
  animation: shimmer 1.4s ease infinite;
}

.skeleton-text {
  height: 16px;
  margin: 12px;
  border-radius: 8px;
  background: #1a2033;
}

.skeleton-btn {
  height: 44px;
  margin: 12px;
  border-radius: 14px;
  background: #1a2033;
  margin-top: auto;
}

@keyframes shimmer {
  0% { background-position: 100% 0; }
  100% { background-position: -100% 0; }
}

    .tabs {
  display: flex;
  gap: 10px;
  margin: 16px 0;
  overflow-x: auto;
}

.tab {
  padding: 10px 16px;
  border-radius: 20px;
  background: #1a2033;
  color: #aaa;
  font-weight: 600;
  white-space: nowrap;
}

.tab.active {
  background: #00e5ff;
  color: #001418;
}

.section {
  margin-top: 16px;
}

.section h3 {
  margin-bottom: 8px;
}

   #bottomNav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 64px;
  background: #0b0f19;
  display: flex;
  border-top: 1px solid #1f253a;
  z-index: 1000;
}

.nav-btn {
  flex: 1;
  background: none;
  border: none;
  color: #8a93b2;
  font-size: 14px;
  font-weight: 600;
}

.nav-btn.active {
  color: #00e5ff;
}

/* —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –∑–∞–ª–µ–∑–∞–ª –ø–æ–¥ –º–µ–Ω—é */
body {
  padding-bottom: 70px;
}

    .card-img-wrap {
  position: relative;
}

.fav-heart {
  position: absolute;
  top: 10px;
  right: 10px;
  font-size: 22px;
  color: #ffffff;
  opacity: 1; /* ü§ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–µ */
  background: rgba(0,0,0,0.35);
  border-radius: 50%;
  padding: 6px;
  cursor: pointer;
  transition: transform .2s ease, color .2s ease, opacity .2s ease;
  -webkit-tap-highlight-color: transparent;
user-select: none;
}
    
/* ‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –∫–ª—É–± ‚Äî —á–∏—Å—Ç—ã–π UI */
.recommended-star {
  position: absolute;
  top: 10px;      /* —Ä–æ–≤–Ω–æ –∫–∞–∫ —É —Å–µ—Ä–¥–µ—á–∫–∞ */
  left: 10px;

  width: 22px;    /* –í–ò–ó–£–ê–õ–¨–ù–û –∫–∞–∫ ‚ù§Ô∏è */
  height: 22px;

  z-index: 2;

  pointer-events: none; /* –Ω–µ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞ */
}

.recommended-star svg {
  width: 100%;
  height: 100%;

  fill: #f5c451;
  stroke: rgba(0,0,0,0.85);   /* üîë –≤–∏–¥–Ω–æ –Ω–∞ —Å–≤–µ—Ç–ª–æ–º —Ñ–æ–Ω–µ */
  stroke-width: 1.2;

  filter: drop-shadow(0 1px 2px rgba(0,0,0,0.6));
}

.fav-heart.active {
  color: #ff3b3b; /* ‚ù§Ô∏è –∞–∫—Ç–∏–≤–Ω–æ–µ */
  opacity: 1;
}

.fav-heart:active {
  transform: scale(0.9);
}

 /* ‚ù§Ô∏è –ê–Ω–∏–º–∞—Ü–∏—è —Å–µ—Ä–¥–µ—á–∫–∞ */
.fav-heart.animate {
  animation: heartPop 0.25s ease;
}

@keyframes heartPop {
  0% {
    transform: scale(1);
  }
  40% {
    transform: scale(1.35);
  }
  70% {
    transform: scale(0.95);
  }
  100% {
    transform: scale(1);
  }
}
    
    .photos-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
    }

    .fade-in {
  animation: fadeIn .35s ease;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

    html, body {
  touch-action: manipulation;
  overscroll-behavior: none;
    }

    .tab-fade-out {
  animation: tabFadeOut .15s ease forwards;
}

.tab-fade-in {
  animation: tabFadeIn .25s ease forwards;
}

@keyframes tabFadeOut {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-6px);
  }
}

@keyframes tabFadeIn {
  from {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
    #promoBtn.active,
#tournamentBtn.active {
  background: linear-gradient(135deg, #00e5ff, #00bcd4);
  color: #001418;
  box-shadow: 0 0 0 2px #00e5ff;
  transform: scale(0.95);
}
    #searchToggle.active {
  background: linear-gradient(135deg, #00e5ff, #00bcd4);
  color: #001418;
  box-shadow: 0 0 0 2px #00e5ff;
    }
    .search-animate {
  animation: searchSlide .25s ease;
}

@keyframes searchSlide {
  from {
    opacity: 0;
    transform: translateY(-6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
    .back-btn {
  width:40px;
  height:40px;
  border-radius:50%;
  background:#1a2033;
  border:none;
  color:#fff;
  font-size:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-bottom:12px;
  cursor:pointer;
}

.back-btn:active {
  transform: scale(0.92);
}
    /* üö´ —É–±–∏—Ä–∞–µ–º —Å–∏–Ω–∏–π tap-highlight —É —Å—Å—ã–ª–æ–∫ */
a {
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}
  </style>
</head>

<body>
  <!-- ===== index.html (–ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô) ===== -->
  <header>
  <h1>–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ –∫–ª—É–±—ã</h1>

  <div style="
  display:flex;
  gap:8px;
  margin-top:12px;
  align-items:center;
">

  <!-- –†–∞–π–æ–Ω—ã -->
  <select id="districtFilter" style="
  flex:1;
  height:44px;
  padding:0 12px;
  border-radius:12px;
  background:#141a2b;
  color:#fff;
  border:none;
  font-size:14px;
  display:flex;
  align-items:center;
  appearance:none;
  -webkit-appearance:none;
  line-height:44px;
  margin-top:0;
">
    <option value="">–í—Å–µ —Ä–∞–π–æ–Ω—ã</option>
  </select>

  <!-- –ê–∫—Ü–∏–∏ -->
  <button id="promoBtn" style="
    width:44px;
    height:44px;
    border-radius:12px;
    border:none;
    background:#1a2033;
    color:#fff;
    font-size:18px;
  ">
    üî•<span id="promoCount" style="margin-left:2px;font-size:12px"></span>
  </button>

  <!-- –¢—É—Ä–Ω–∏—Ä—ã -->
  <button id="tournamentBtn" style="
    width:44px;
    height:44px;
    border-radius:12px;
    border:none;
    background:#1a2033;
    color:#fff;
    font-size:18px;
  ">
    üèÜ<span id="tournamentCount" style="margin-left:2px;font-size:12px"></span>
  </button>

  <!-- –ü–æ–∏—Å–∫ -->
  <button id="searchToggle" style="
    width:44px;
    height:44px;
    border-radius:12px;
    border:none;
    background:#141a2b;
    color:#fff;
    font-size:18px;
  ">
    üîç
  </button>

</div>

<!-- –°–∫—Ä—ã—Ç—ã–π –ø–æ–∏—Å–∫ -->
<input
  id="searchInput"
  type="text"
  placeholder="–ü–æ–∏—Å–∫ –∫–ª—É–±–∞"
  style="
    display:none;
    margin-top:10px;
    width:100%;
    height:44px;
    padding:0 14px;
    border-radius:12px;
    background:#141a2b;
    border:none;
    outline:none;
    color:#fff;
    font-size:14px;
  "
/>
    </div>
  </div>
  </header>

  <main id="clubs"></main>
  <section id="favoritesPage" style="display:none;"></section>
  <section id="statsPage" style="display:none;"></section>
  <section id="clubPage" style="display:none;"></section>
  <section id="zonePage" style="display:none;"></section>
  <!-- ===== app.js (–ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô) ===== -->
  <script>
    const SUPABASE_URL = "https://dyxfvhjggmessxfuhnbr.supabase.co";
    const SUPABASE_KEY = "sb_publishable_WVIM_p30Vjag_MTxDWapEQ__W0SftDv";
    const STATS_DAYS = 30;
const tg = window.Telegram?.WebApp;
    const clickLock = {};

function lockClick(key, delay = 600) {
  if (clickLock[key]) return true;
  clickLock[key] = true;
  setTimeout(() => delete clickLock[key], delay);
  return false;
}
    const ADMIN_TELEGRAM_ID = 938184349; // ‚Üê –≤—Å—Ç–∞–≤—å –°–í–û–ô ID
    // üìä –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
async function trackDailyVisit() {
  try {
    const user = tg?.initDataUnsafe?.user;
    if (!user) return;

    const today = new Date().toISOString().slice(0, 10);
    const lastVisitKey = `last_visit_${user.id}`;

    // –µ—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è —É–∂–µ –∑–∞–ø–∏—Å—ã–≤–∞–ª–∏ ‚Äî –≤—ã—Ö–æ–¥–∏–º
    if (localStorage.getItem(lastVisitKey) === today) {
      return;
    }

   // üìä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –ø–æ—Å–µ—â–µ–Ω–∏–π –∑–∞ –¥–µ–Ω—å
const statsRes = await fetch(
  `${SUPABASE_URL}/rest/v1/daily_stats?day=eq.${today}`,
  {
    headers: {
      apikey: SUPABASE_KEY,
      Authorization: `Bearer ${SUPABASE_KEY}`,
    },
  }
);

const statsToday = await statsRes.json();

if (statsToday.length === 0) {
  // –µ—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –∑–∞ –¥–µ–Ω—å –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë–º
  await fetch(`${SUPABASE_URL}/rest/v1/daily_stats`, {
    method: "POST",
    headers: {
      apikey: SUPABASE_KEY,
      Authorization: `Bearer ${SUPABASE_KEY}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      day: today,
      visits: 1
    })
  });
} else {
  // –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –µ—Å—Ç—å ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º visits
  await fetch(
    `${SUPABASE_URL}/rest/v1/daily_stats?day=eq.${today}`,
    {
      method: "PATCH",
      headers: {
        apikey: SUPABASE_KEY,
        Authorization: `Bearer ${SUPABASE_KEY}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        visits: statsToday[0].visits + 1
      })
    }
  );
}
    localStorage.setItem(lastVisitKey, today);
  } catch (e) {
    console.log("visit skipped");
  }
}
    // üõ°Ô∏è –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –≤—Å—Ç–∞–≤–∫–∏ —Ç–µ–∫—Å—Ç–∞
function safe(text) {
  if (!text) return '';
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

if (tg) {
  tg.ready();
  tg.expand();
  
  // üìä –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –ø–æ—Å–µ—â–µ–Ω–∏–µ
  trackDailyVisit();
}
    
    // üìã –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –¥–µ–π—Å—Ç–≤–∏–π
const SCROLL_TO_TOP = () => window.scrollTo(0, 0);
const HIDE_HEADER = () => document.querySelector("header").style.display = "none";
const SHOW_HEADER = () => document.querySelector("header").style.display = "block";
    
    const clubsContainer = document.getElementById("clubs");
    const filter = document.getElementById("districtFilter");
    const searchInput = document.getElementById("searchInput");
    const searchToggle = document.getElementById("searchToggle");

searchToggle.onclick = () => {
  const isOpen = searchInput.style.display === "block";

  // üî¥ –°–ë–†–û–° –∞–∫—Ü–∏–π / —Ç—É—Ä–Ω–∏—Ä–æ–≤
  specialFilter = "";
  promoBtn.classList.remove("active");
  tournamentBtn.classList.remove("active");

  if (isOpen) {
    searchInput.style.display = "none";
    searchInput.value = "";
    searchToggle.classList.remove("active");
  } else {
    searchInput.style.display = "block";
searchInput.classList.remove("search-animate");
void searchInput.offsetWidth; // –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
searchInput.classList.add("search-animate");
    searchInput.focus();
    searchToggle.classList.add("active");
  }

  renderClubs();
};
    const clubPage = document.getElementById("clubPage");

    let clubs = [];
    let activeZoneIndex = 0;
    let clubOpenedFrom = "clubs";
    let specialFilter = ""; // "", "promo", "tournament"
    let skipTabAnimation = false;
    
    async function loadClubs() {
  clubsContainer.innerHTML = `
    <div class="skeleton">
      <div class="skeleton-img"></div>
      <div class="skeleton-text"></div>
      <div class="skeleton-btn"></div>
    </div>
    <div class="skeleton">
      <div class="skeleton-img"></div>
      <div class="skeleton-text"></div>
      <div class="skeleton-btn"></div>
    </div>
  `;
  
  // 1Ô∏è‚É£ –ü—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞
  const cached = localStorage.getItem("clubs_cache");
  let usingCache = false;

  if (cached) {
    try {
      clubs = JSON.parse(cached);
      renderDistricts();
      renderClubs();
      usingCache = true;
    } catch (e) {
      console.log("–ö—ç—à –ø–æ–≤—Ä–µ–∂–¥—ë–Ω");
      localStorage.removeItem("clubs_cache"); // —É–¥–∞–ª—è–µ–º —Å–ª–æ–º–∞–Ω–Ω—ã–π –∫—ç—à
    }
  }

  // 2Ô∏è‚É£ –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å Supabase
  try {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/clubs?select=*`, {
      headers: {
        apikey: SUPABASE_KEY,
        Authorization: `Bearer ${SUPABASE_KEY}`,
      },
    });

    // ‚úÖ –ü–†–û–í–ï–†–Ø–ï–ú, —á—Ç–æ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω
    if (!res.ok) {
      throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${res.status}`);
    }

    const freshData = await res.json();

    // ‚úÖ –ü–†–û–í–ï–†–Ø–ï–ú, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã
    if (!Array.isArray(freshData)) {
      throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö");
    }

    // 3Ô∏è‚É£ –û–±–Ω–æ–≤–ª—è–µ–º —ç–∫—Ä–∞–Ω –∏ –∫—ç—à —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
    if (JSON.stringify(freshData) !== JSON.stringify(clubs)) {
      clubs = freshData;
      localStorage.setItem("clubs_cache", JSON.stringify(clubs));
      renderDistricts();
      renderClubs();
    } else if (usingCache) {
      // –î–∞–Ω–Ω—ã–µ —Ç–µ –∂–µ, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å —É—Å–ø–µ—à–Ω–æ
      console.log("‚úÖ –î–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã");
    }
    
  } catch (err) {
    console.log("‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", err.message);
    
    // –ï—Å–ª–∏ –∫—ç—à–∞ –Ω–µ—Ç –≤–æ–æ–±—â–µ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
    if (!usingCache) {
      clubsContainer.innerHTML = `
        <div style="
          padding:40px 20px;
          text-align:center;
          opacity:.7
        ">
          <div style="font-size:48px;margin-bottom:16px">‚ö†Ô∏è</div>
          <h3>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–ª—É–±—ã</h3>
          <p style="opacity:.8;margin:12px 0">
            –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
          </p>
          <button onclick="loadClubs()" style="
            margin-top:16px;
            padding:12px 24px;
            border:none;
            border-radius:12px;
            background:#00e5ff;
            font-weight:600;
            cursor:pointer;
          ">
            üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
          </button>
        </div>
      `;
    }
    // –ï—Å–ª–∏ –∫—ç—à –µ—Å—Ç—å ‚Äî –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ (—É–∂–µ –ø–æ–∫–∞–∑–∞–Ω)
  }
      // üñºÔ∏è –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ —Ñ–æ–Ω–µ
function preloadImages() {
  clubs.forEach(club => {
    // –§–æ—Ç–æ –∫–ª—É–±–æ–≤
    if (Array.isArray(club.photos) && club.photos.length) {
      club.photos.forEach(photo => {
        const img = new Image();
        img.src = photo.url;
      });
    }
    
    // –ò–∫–æ–Ω–∫–∏ –∏–≥—Ä
    if (Array.isArray(club.games) && club.games.length) {
      club.games.forEach(game => {
        if (game.icon) {
          const img = new Image();
          img.src = game.icon;
        }
      });
    }
    
    // –ò–∫–æ–Ω–∫–∏ –∑–æ–Ω
    if (Array.isArray(club.zones) && club.zones.length) {
      club.zones.forEach(zone => {
        if (zone.icon) {
          const img = new Image();
          img.src = zone.icon;
        }
      });
    }
  });
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É —á–µ—Ä–µ–∑ 500–º—Å (—á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ)
setTimeout(preloadImages, 500);
    }

    function renderDistricts() {
  // –æ—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ä–∞–π–æ–Ω–æ–≤
  filter.innerHTML = `<option value="">–í—Å–µ —Ä–∞–π–æ–Ω—ã</option>`;

  const districts = [...new Set(clubs.map(c => c.district))];

  districts.forEach(d => {
    const opt = document.createElement("option");
    opt.value = d;
    opt.textContent = d;
    filter.appendChild(opt);
  });
    }

    function renderClubs() {
      clubsContainer.innerHTML = "";
let visibleCount = 0;
      const promoCount = clubs.filter(c => c.promo).length;
const tournamentCount = clubs.filter(c => c.tournament).length;

document.getElementById("promoCount").textContent =
  promoCount > 0 ? promoCount : "";

document.getElementById("tournamentCount").textContent =
  tournamentCount > 0 ? tournamentCount : "";
      if (specialFilter === "promo") {
  clubsContainer.innerHTML = `
    <div style="
      grid-column:1 / -1;
      margin-bottom:12px;
      padding:10px;
      border-radius:12px;
      background:#102a1c;
      color:#00e676;
      font-weight:600;
      text-align:center;
    ">
      üî• –ü–æ–∫–∞–∑–∞–Ω—ã –∫–ª—É–±—ã —Å –∞–∫—Ü–∏—è–º–∏
    </div>
  `;
}

if (specialFilter === "tournament") {
  clubsContainer.innerHTML = `
    <div style="
      grid-column:1 / -1;
      margin-bottom:12px;
      padding:10px;
      border-radius:12px;
      background:#1a2033;
      color:#00e5ff;
      font-weight:600;
      text-align:center;
    ">
      üèÜ –ü–æ–∫–∞–∑–∞–Ω—ã –∫–ª—É–±—ã —Å —Ç—É—Ä–Ω–∏—Ä–∞–º–∏
    </div>
  `;
}

      const selected = filter.value;
const query = searchInput.value.toLowerCase();

clubs
  .filter(c => {
    if (specialFilter === "promo" && !c.promo) return false;
    if (specialFilter === "tournament" && !c.tournament) return false;

    return (
      (!selected || c.district === selected) &&
      (!query || (c.name || "").toLowerCase().includes(query))
    );
  })
  .sort((a, b) => {
  const aScore =
    (a.recommended ? 100 : 0) +
    (a.promo ? 2 : 0) +
    (a.tournament ? 1 : 0);

  const bScore =
    (b.recommended ? 100 : 0) +
    (b.promo ? 2 : 0) +
    (b.tournament ? 1 : 0);

  return bScore - aScore;
})
  .forEach((c) => {
    visibleCount++;
          const img =
  Array.isArray(c.photos) && c.photos.length
    ? c.photos[0].url
    : "https://via.placeholder.com/400x200";

          clubsContainer.innerHTML += `
            <div class="card">
  <div class="card-img-wrap">
  <img src="${img}">

  ${c.recommended ? `
  <div class="recommended-star">
  <svg viewBox="0 0 24 24" aria-hidden="true">
    <path d="M12 2.5l2.9 6.1 6.6.6-5 4.4 1.5 6.4L12 16.8 6 20l1.5-6.4-5-4.4 6.6-.6L12 2.5z"/>
  </svg>
</div>
` : ""}

  <div class="fav-heart ${isFavorite(c.id) ? "active" : ""}"
     data-id="${c.id}">
  ‚ô•
</div>
</div>

  <h2>${safe(c.name)}</h2>
  ${c.promo ? `
  <div style="
    margin:0 12px 6px;
    padding:6px 8px;
    background:#102a1c;
    border-radius:8px;
    font-size:12px;
    color:#00e676;
    font-weight:600;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  ">
    üî• ${safe(c.promo).slice(0, 30)}
  </div>
` : ""}

${c.tournament ? `
  <div style="
    margin:0 12px 6px;
    padding:6px 8px;
    background:#1a2033;
    border-radius:8px;
    font-size:12px;
    color:#00e5ff;
    font-weight:600;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  ">
    üèÜ ${safe(c.tournament).slice(0, 30)}
  </div>
` : ""}
  <button onclick="clubOpenedFrom='clubs'; openClub(${Number(c.id)})">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
</div>
          `;
        });
      if (visibleCount === 0) {
  clubsContainer.innerHTML = `
    <div style="
      grid-column:1 / -1;
      text-align:center;
      padding:40px 20px;
      opacity:.7
    ">
      <div style="font-size:48px;margin-bottom:12px">üòï</div>
      <h3>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
      <p style="margin-top:8px">
        –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –ø–æ–∏—Å–∫
      </p>
    </div>
  `;
      }
    }

    filter.addEventListener("change", () => {
  specialFilter = "";
  promoBtn.classList.remove("active");
  tournamentBtn.classList.remove("active");
  renderClubs();
});

searchInput.addEventListener("input", () => {
  specialFilter = "";
  promoBtn.classList.remove("active");
  tournamentBtn.classList.remove("active");
  renderClubs();
});
    const promoBtn = document.getElementById("promoBtn");
const tournamentBtn = document.getElementById("tournamentBtn");

promoBtn.onclick = () => {
  if (lockClick("promo", 400)) return;
  if (specialFilter === "promo") {
    // –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ ‚Üí —Å–±—Ä–æ—Å
    specialFilter = "";
    promoBtn.classList.remove("active");
  } else {
    specialFilter = "promo";
    promoBtn.classList.add("active");
    tournamentBtn.classList.remove("active");
  }
  // üîç –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∏—Å–∫, –µ—Å–ª–∏ –±—ã–ª –æ—Ç–∫—Ä—ã—Ç
searchInput.style.display = "none";
searchInput.value = "";
searchToggle.classList.remove("active");
  renderClubs();
};

tournamentBtn.onclick = () => {
  if (lockClick("tournament", 400)) return;
  if (specialFilter === "tournament") {
    // –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ ‚Üí —Å–±—Ä–æ—Å
    specialFilter = "";
    tournamentBtn.classList.remove("active");
  } else {
    specialFilter = "tournament";
    tournamentBtn.classList.add("active");
    promoBtn.classList.remove("active");
  }
  // üîç –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∏—Å–∫, –µ—Å–ª–∏ –±—ã–ª –æ—Ç–∫—Ä—ã—Ç
searchInput.style.display = "none";
searchInput.value = "";
searchToggle.classList.remove("active");
  renderClubs();
};

    function openClub(id) {
  const club = clubs.find((c) => c.id === id);
  if (!club) return;
      clubPage.innerHTML = `
  <div style="
    padding:40px;
    text-align:center;
    opacity:.7
  ">
    <div style="font-size:40px">‚è≥</div>
    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª—É–±–∞...</p>
  </div>
`;
      // ‚¨ÜÔ∏è –í–°–ï–ì–î–ê –ø–æ–¥–Ω–∏–º–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–≤–µ—Ä—Ö
SCROLL_TO_TOP();

  document.getElementById("clubs").style.display = "none";
  document.getElementById("favoritesPage").style.display = "none";
  clubPage.style.display = "block";

      HIDE_HEADER();
      
      clubPage.dataset.photos = JSON.stringify(club.photos || []);
clubPage.dataset.lat = club.lat || "";
clubPage.dataset.lng = club.lng || "";
clubPage.dataset.admin = club.admin_link || "";
clubPage.dataset.priceHour = club.price_hour || "";
clubPage.dataset.priceNight = club.price_night || "";
clubPage.dataset.priceVip = club.price_vip || "";
clubPage.dataset.cpu = club.cpu || "";
clubPage.dataset.gpu = club.gpu || "";
clubPage.dataset.ram = club.ram || "";
clubPage.dataset.mouse = club.mouse || "";
clubPage.dataset.keyboard = club.keyboard || "";
clubPage.dataset.headset = club.headset || "";
 clubPage.dataset.games = JSON.stringify(club.games || []);
clubPage.dataset.zones = JSON.stringify(club.zones || []);
clubPage.dataset.address = club.address || '';
clubPage.dataset.workTime = club.work_time || '';
clubPage.dataset.phone = club.phone || '';
clubPage.dataset.instagram = club.instagram || '';
clubPage.dataset.promo = club.promo || "";
clubPage.dataset.tournament = club.tournament || "";
clubPage.dataset.promoImage = club.promo_image || "";
clubPage.dataset.tournamentImage = club.tournament_image || "";
      
  clubPage.innerHTML = `
    <div style="padding:16px;min-height:100vh">

      <button onclick="goBack()" class="back-btn">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
     xmlns="http://www.w3.org/2000/svg">
  <path d="M15 18l-6-6 6-6"
        stroke="currentColor"
        stroke-width="2.2"
        stroke-linecap="round"
        stroke-linejoin="round"/>
</svg>
</button>

      <h2 style="display:flex;align-items:center;gap:10px">
  ${safe(club.name)}
  <span id="openBadge" style="font-size:14px"></span>
</h2>
      <p>üìç ${safe(club.district)}</p>

      <div class="tabs">
  <div class="tab active" onclick="showTab('main')">–ì–ª–∞–≤–Ω–∞—è</div>
  <div class="tab" onclick="showTab('zones')">–ó–æ–Ω—ã</div>
  <div class="tab" onclick="showTab('games')">–ò–≥—Ä—ã</div>

  ${club.promo ? `
    <div class="tab" onclick="showTab('promo')">üî• –ê–∫—Ü–∏–∏</div>
  ` : ""}

  ${club.tournament ? `
    <div class="tab" onclick="showTab('tournament')">üèÜ –¢—É—Ä–Ω–∏—Ä—ã</div>
  ` : ""}
</div>

      <div id="tabContent"></div>
      
    </div>
  `;

  showTab("main");
      const badge = document.getElementById("openBadge");
const isOpen = isClubOpen(clubPage.dataset.workTime);

if (badge) {
  if (isOpen === true) {
    badge.textContent = "üü¢ –û—Ç–∫—Ä—ã—Ç–æ";
    badge.style.color = "#00e676";
  } else if (isOpen === false) {
    badge.textContent = "üî¥ –ó–∞–∫—Ä—ã—Ç–æ";
    badge.style.color = "#ff5252";
  } else {
    badge.textContent = "";
  }
}
    }

    function showTab(tab) {
      // –≤—Å–µ–≥–¥–∞ —Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
statsPage.style.display = "none";
  const content = document.getElementById("tabContent");
  if (!content) return;
      
      document.querySelectorAll(".tab").forEach(t => {
    t.classList.remove("active");
  });
  document.querySelector(`.tab[onclick*="${tab}"]`)?.classList.add("active");
      
// –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é (–≤–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥)
if (skipTabAnimation) {
  skipTabAnimation = false;

  if (tab === "zones") {
    const zones = JSON.parse(clubPage.dataset.zones || "[]");

    content.innerHTML = zones.map((z, i) => `
      <div
        class="zone-item"
        onclick="openZone(${i})"
        style="
          display:flex;
          align-items:center;
          gap:12px;
          padding:14px;
          margin-bottom:10px;
          border-radius:14px;
          background:#1a2033;
        "
      >
        ${z.icon ? `<img src="${z.icon}" style="width:36px;height:36px">` : ''}
        <span style="font-weight:600">${safe(z.name)}</span>
      </div>
    `).join("");
  }

  return;
}

// –æ–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
if (content.dataset.animating === "1") return;
content.dataset.animating = "1";
// –∑–∞–ø—É—Å–∫–∞–µ–º fade-out
content.className = "";
content.classList.add("tab-fade-out");

// –∂–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è fade-out
setTimeout(() => { 
  if (tab === "main") {
  const photos = JSON.parse(clubPage.dataset.photos || "[]");

    content.innerHTML = `
  <div class="section">

    <!-- ‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div style="
      margin-bottom:16px;
      padding:16px;
      background:#0f172a;
      border-radius:18px
    ">
      <h3 style="margin-top:0">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>

      ${clubPage.dataset.address ? `<p>üìç ${safe(clubPage.dataset.address)}</p>` : ''}
${clubPage.dataset.workTime ? `<p>üïí ${safe(clubPage.dataset.workTime)}</p>` : ''}
${clubPage.dataset.phone
  ? `
    <a href="tel:${clubPage.dataset.phone.replace(/\s+/g, '')}" style="
      display:flex;
      align-items:center;
      gap:8px;
      margin-top:6px;
      text-decoration:none;
      color:#00e5ff;
      font-weight:600;
    ">
      üìû ${safe(clubPage.dataset.phone)}
    </a>
  `
  : ''}
      ${clubPage.dataset.instagram &&
clubPage.dataset.instagram.startsWith("http")
? `
  <a href="${clubPage.dataset.instagram}" target="_blank" style="
    display:flex;
    align-items:center;
    gap:10px;
    margin-top:8px;
    text-decoration:none;
    color:#fff;
  ">
    <img
      src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png"
      style="width:22px;height:22px"
    />
    <span style="color:#00e5ff;font-weight:600">Instagram</span>
  </a>
`
: ''}
    </div>

    <!-- –§–æ—Ç–æ -->
    <div class="photos-grid">
      ${photos.map(p => `
        <div>
          <img
  src="${p.url}"
  onclick="openImage('${p.url}')"
  style="
    width:100%;
    height:140px;
    object-fit:cover;
    border-radius:14px;
    display:block;
    cursor:pointer;
  "
>
          <p style="
  margin-top:6px;
  font-size:12px;
  opacity:.6;
  text-align:center;
">
  ${p.title || ""}
</p>
        </div>
      `).join("")}
    </div>

    <div style="margin-top:16px">
      <button onclick="openMap(${clubPage.dataset.lat},${clubPage.dataset.lng})"
        style="
          width:100%;
          padding:14px;
          border:none;
          border-radius:12px;
          background:#141a2b;
          color:#00e5ff;
          font-weight:600;
        ">
        üìç –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É
      </button>

      <button onclick="openAdmin('${clubPage.dataset.admin}')"
        style="
          margin-top:12px;
          width:100%;
          padding:14px;
          border:none;
          border-radius:12px;
          background:#00e5ff;
          font-weight:600;
        ">
        üí¨ –°–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–æ–º
      </button>
    </div>

  </div>
`;
  }

  if (tab === "zones") {
  const zones = JSON.parse(clubPage.dataset.zones || "[]");

  if (!zones.length) {
    content.innerHTML = `<p>–ó–æ–Ω—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã</p>`;
    return;
  }

  content.innerHTML = zones.map((z, i) => `
    <div
  class="zone-item"
  onclick="openZone(${i})"
  style="
    display:flex;
    align-items:center;
    gap:12px;
    padding:14px;
    margin-bottom:10px;
    border-radius:14px;
    background:#1a2033;
  "
>
      ${z.icon ? `<img src="${z.icon}" style="width:36px;height:36px">` : ''}
      <span style="font-weight:600">${safe(z.name)}</span>
    </div>
  `).join("");
  }

  if (tab === "games") {
  const games = JSON.parse(clubPage.dataset.games || "[]");

  if (!Array.isArray(games) || games.length === 0) {
    content.innerHTML = `<p style="opacity:.7">–ò–≥—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã</p>`;
    return;
  }

  content.innerHTML = `
    <div style="display:grid; gap:12px">
      ${games.map(game => `
        <div style="
          display:flex;
          align-items:center;
          gap:12px;
          background:#141a2b;
          border-radius:12px;
          padding:12px;
        ">
          <img src="${game.icon || ''}"
               style="width:40px;height:40px;object-fit:contain"
               onerror="this.style.display='none'">

          <div style="flex:1">
            <div style="font-weight:600">${safe(game.name) || '–ò–≥—Ä–∞'}</div>
            <div style="font-size:13px;opacity:.7">
              ${game.fps ? `FPS: ${game.fps}` : ''}
              ${game.hz ? ` ¬∑ ${game.hz} –ì—Ü` : ''}
            </div>
          </div>
        </div>
      `).join("")}
    </div>
  `;
  }
  if (tab === "promo") {
  content.innerHTML = `
    <div class="section">

      ${
        clubPage.dataset.promoImage
          ? `
            <img
              src="${clubPage.dataset.promoImage}"
              style="
                width:100%;
                border-radius:18px;
                margin-bottom:14px;
              "
            />
          `
          : ""
      }

      <div style="
        background:#102a1c;
        border-radius:18px;
        padding:16px
      ">
        <h3 style="margin-top:0">üî• –ê–∫—Ü–∏–∏</h3>
        <p style="font-size:15px;line-height:1.5">
          ${safe(clubPage.dataset.promo)}
        </p>
      </div>

    </div>
  `;
  }

if (tab === "tournament") {
  content.innerHTML = `
    <div class="section">

      ${
        clubPage.dataset.tournamentImage
          ? `
            <img
              src="${clubPage.dataset.tournamentImage}"
              style="
                width:100%;
                border-radius:18px;
                margin-bottom:14px;
              "
            />
          `
          : ""
      }

      <div style="
        background:#1a2033;
        border-radius:18px;
        padding:16px
      ">
        <h3 style="margin-top:0">üèÜ –¢—É—Ä–Ω–∏—Ä—ã</h3>
        <p style="font-size:15px;line-height:1.5">
          ${safe(clubPage.dataset.tournament)}
        </p>
      </div>

    </div>
  `;
}
// –∑–∞–ø—É—Å–∫–∞–µ–º fade-in –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
content.className = "";
content.classList.add("tab-fade-in");

// —Ä–∞–∑—Ä–µ—à–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ –∫–ª–∏–∫–∏
content.dataset.animating = "0";
}, 180);
    }

    function goBack() {
      SCROLL_TO_TOP();

  clubPage.style.display = "none";
  SHOW_HEADER();

  if (clubOpenedFrom === "favorites") {
    showFavoritesTab();
  } else {
    showClubsTab();
  }
    }

    function openAdmin(link) {
  if (!link || link.trim() === '') {
    alert("‚ùå –°—Å—ã–ª–∫–∞ –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞");
    return;
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Å—Å—ã–ª–∫—É
  if (!link.startsWith('http://') && !link.startsWith('https://') && !link.startsWith('tg://')) {
    alert("‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞");
    return;
  }
  
  window.open(link, "_blank");
    }

    function openMap(lat, lng) {
  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Å–ª–∞
  const latitude = parseFloat(lat);
  const longitude = parseFloat(lng);
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞–ª–∏–¥–Ω—ã–µ
  if (
  isNaN(latitude) || isNaN(longitude) ||
  latitude < -90 || latitude > 90 ||
  longitude < -180 || longitude > 180
) {
    alert("‚ùå –õ–æ–∫–∞—Ü–∏—è –∫–ª—É–±–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞");
    return;
  }

  window.open(`https://www.google.com/maps?q=${latitude},${longitude}`, "_blank");
    }

    loadClubs();

    function showClubsTab() {
  SCROLL_TO_TOP();
  document.getElementById("statsPage").style.display = "none";

  document.getElementById("favoritesPage").style.display = "none";
  document.getElementById("clubs").style.display = "grid";
  clubPage.style.display = "none";

  SHOW_HEADER();

  setActiveBottomTab("clubs");
    }

function showFavoritesTab() {
  SCROLL_TO_TOP();
  document.getElementById("statsPage").style.display = "none";
  HIDE_HEADER();
  document.getElementById("clubs").style.display = "none";
  clubPage.style.display = "none";

  renderFavorites();

  setActiveBottomTab("favorites");
}

    function renderFavorites() {
  const page = document.getElementById("favoritesPage");
  const clubsPage = document.getElementById("clubs");

  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–±—Ä–∞–Ω–Ω–æ–µ, —Å–∫—Ä—ã–≤–∞–µ–º –∫–ª—É–±—ã
  page.style.display = "block";
  clubsPage.style.display = "none";

  const favIds = JSON.parse(localStorage.getItem("favorites") || "[]");
const favClubs = clubs.filter(c => favIds.includes(c.id));

if (favClubs.length === 0) {
  page.innerHTML = `
    <div style="
      padding:16px;
      font-size:22px;
      font-weight:700;
    ">
      ‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
    </div>

    <div style="
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:40px 20px;
      opacity:.85
    ">
      <div style="font-size:56px;margin-bottom:12px">‚ù§Ô∏è</div>
      <h3 style="margin:0 0 8px 0">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</h3>
      <p style="margin:0;opacity:.7">
        –î–æ–±–∞–≤–ª—è–π –∫–ª—É–±—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ,<br>
        —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –∏—Ö
      </p>
    </div>
  `;
  return;
}

page.innerHTML = `
  <div style="
    padding:16px;
    font-size:22px;
    font-weight:700;
  ">
    ‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
  </div>

  ${favClubs.map(c => `
    <div class="card">
      <h2>${safe(c.name)}</h2>
      <button onclick="clubOpenedFrom='favorites'; openClub(${c.id})">
        –ü–æ–¥—Ä–æ–±–Ω–µ–µ
      </button>
    </div>
  `).join("")}
`;
    }

    function isFavorite(id) {
  const favs = JSON.parse(localStorage.getItem("favorites") || "[]");
  return favs.includes(id);
    }
    
    function toggleFavorite(id) {
      if (lockClick("fav_" + id)) return;
  let favs = JSON.parse(localStorage.getItem("favorites") || "[]");

  const exists = favs.includes(id);

  if (exists) {
    favs = favs.filter(favId => favId !== id);
  } else {
    favs.push(id);
  }

  localStorage.setItem("favorites", JSON.stringify(favs));

  // ‚ù§Ô∏è –ê–ù–ò–ú–ê–¶–ò–Ø –°–ï–†–î–ï–ß–ö–ê
  const heart = document.querySelector(`.fav-heart[data-id="${id}"]`);
  if (heart) {
    heart.classList.remove("animate"); // —Å–±—Ä–æ—Å
    void heart.offsetWidth;            // –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
    heart.classList.add("animate");
}

// ‚è± –¥–∞—ë–º –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–æ–∏–≥—Ä–∞—Ç—å—Å—è
setTimeout(() => {
  renderClubs();

  if (document.getElementById("favoritesPage").style.display === "block") {
    renderFavorites();
  }
}, 250);
    }

    function openZone(index) {
  const zones = JSON.parse(clubPage.dataset.zones || "[]");
  const zone = zones[index];
  if (!zone) return;

  activeZoneIndex = index;

  SCROLL_TO_TOP();

  document.getElementById("clubPage").style.display = "none";
  document.getElementById("zonePage").style.display = "block";

  const prices = zone.prices || {};
  const specs = zone.specs || {};

  zonePage.innerHTML = `
  <div style="padding:16px;display:flex;flex-direction:column;gap:16px">

    <!-- –ù–∞–∑–∞–¥ -->
    <button onclick="goBackToZones()" class="back-btn">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
       xmlns="http://www.w3.org/2000/svg">
    <path d="M15 18l-6-6 6-6"
          stroke="currentColor"
          stroke-width="2.2"
          stroke-linecap="round"
          stroke-linejoin="round"/>
  </svg>
</button>

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–æ–Ω—ã -->
    <div style="
      background:linear-gradient(135deg,#1e293b,#0f172a);
      border-radius:20px;
      padding:20px
    ">
      <h2 style="margin:0">${safe(zone.name)}</h2>
    </div>

    <!-- –¶–µ–Ω—ã -->
    <div style="
      background:#0f172a;
      border-radius:18px;
      padding:16px
    ">
      <h3 style="margin-top:0">üí∞ –¶–µ–Ω—ã</h3>

      ${
  zone.prices?.hour_ranges
    ? zone.prices.hour_ranges.map(r => `
        <div style="display:flex;justify-content:space-between">
          <span>${r.from} ‚Äì ${r.to}</span>
          <b>${r.price}</b>
        </div>
      `).join("")
    : zone.prices?.hour
      ? `
        <div style="display:flex;justify-content:space-between">
          <span>1 —á–∞—Å</span>
          <b>${zone.prices.hour}</b>
        </div>
      `
      : ''
      }
      
      ${zone.prices?.night
  ? `
    <div style="
      margin-top:10px;
      padding-top:10px;
      border-top:1px dashed rgba(255,255,255,.15)
    ">
      <div style="display:flex;justify-content:space-between">
        <span>üåô –ù–æ—á–Ω–æ–π –ø–∞–∫–µ—Ç (${zone.prices.night.from} ‚Äì ${zone.prices.night.to})</span>
        <b>${zone.prices.night.price}</b>
      </div>
    </div>
  `
  : ''
      }
      
      ${zone.prices?.package_3h ? `
        <div style="display:flex;justify-content:space-between">
          <span>3 —á–∞—Å–∞</span><b>${zone.prices.package_3h}</b>
        </div>` : ''}

      ${zone.prices?.package_5h ? `
        <div style="display:flex;justify-content:space-between">
          <span>5 —á–∞—Å–æ–≤</span><b>${zone.prices.package_5h}</b>
        </div>` : ''}
    </div>

    <!-- CS2 -->
    <div style="
      background:#0f172a;
      border-radius:18px;
      padding:16px
    ">
      <h3 style="margin-top:0">üéÆ CS2</h3>

      ${zone.games?.cs2 ? `
        <div style="display:flex;justify-content:space-between">
          <span>FPS</span><b>${zone.games.cs2.fps}</b>
        </div>
        <div style="display:flex;justify-content:space-between">
          <span>–ß–∞—Å—Ç–æ—Ç–∞</span><b>${zone.games.cs2.hz} Hz</b>
        </div>
      ` : `<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>`}
    </div>

    <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
    <div style="
      background:#0f172a;
      border-radius:18px;
      padding:16px
    ">
      <h3 style="margin-top:0">üñ• –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>

      <div style="display:grid;gap:6px">
        <div>CPU: <b>${zone.specs?.cpu || '‚Äî'}</b></div>
        <div>GPU: <b>${zone.specs?.gpu || '‚Äî'}</b></div>
        <div>RAM: <b>${zone.specs?.ram || '‚Äî'}</b></div>
      </div>
    </div>

    <!-- –ü–µ—Ä–∏—Ñ–µ—Ä–∏—è -->
    <div style="
      background:#0f172a;
      border-radius:18px;
      padding:16px
    ">
      <h3 style="margin-top:0">üéß –ü–µ—Ä–∏—Ñ–µ—Ä–∏—è</h3>

      <div style="display:grid;gap:6px">
        <div>–ú—ã—à—å: <b>${zone.specs?.mouse || '‚Äî'}</b></div>
        <div>–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞: <b>${zone.specs?.keyboard || '‚Äî'}</b></div>
        <div>–ù–∞—É—à–Ω–∏–∫–∏: <b>${zone.specs?.headset || '‚Äî'}</b></div>
      </div>
    </div>

  </div>
`;
    }

    function goBackToZones() {
  SCROLL_TO_TOP();
  document.getElementById("zonePage").style.display = "none";
  document.getElementById("clubPage").style.display = "block";

  skipTabAnimation = true;
  showTab("zones");
    }

    function openImage(src) {
  const viewer = document.getElementById("imageViewer");
  const img = document.getElementById("viewerImg");
  img.src = src;
  viewer.style.display = "flex";
}

function closeImage() {
  document.getElementById("imageViewer").style.display = "none";
}

    let lastTouchEnd = 0;

document.addEventListener("touchend", function (event) {
  const now = Date.now();
  if (now - lastTouchEnd <= 300) {
    event.preventDefault();
  }
  lastTouchEnd = now;
}, false);

    function isClubOpen(workTime) {
  if (!workTime) return null;

  // –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
  const clean = workTime
    .replace(/[‚Äì‚Äî]/g, "-")
    .replace(/\./g, ":")
    .replace(/\s+/g, "");

  if (!clean.includes("-")) return null;

  const [start, end] = clean.split("-");

  const parse = (t) => {
    const [h, m] = t.split(":").map(Number);
    if (isNaN(h) || isNaN(m)) return null;
    return h * 60 + m;
  };

  const s = parse(start);
  const e = parse(end);
  if (s === null || e === null) return null;

  const now = new Date();
  const cur = now.getHours() * 60 + now.getMinutes();

  return s < e
    ? cur >= s && cur <= e
    : cur >= s || cur <= e;
    }

    // üìä –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
async function showStatsTab() {
  const user = tg?.initDataUnsafe?.user;

  if (!user || user.id !== ADMIN_TELEGRAM_ID) {
    alert("‚õî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É");
    return;
  }

  SCROLL_TO_TOP();
  HIDE_HEADER();

  document.getElementById("clubs").style.display = "none";
  document.getElementById("favoritesPage").style.display = "none";
  document.getElementById("clubPage").style.display = "none";

  const statsPage = document.getElementById("statsPage");
  statsPage.style.display = "block";
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
  statsPage.innerHTML = `
    <div style="padding:20px;text-align:center">
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
    </div>
  `;
  
  try {
    // üìä –ß–∏—Ç–∞–µ–º –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –¥–Ω—è–º
const res = await fetch(
  `${SUPABASE_URL}/rest/v1/daily_stats?order=day.desc&limit=${STATS_DAYS}`,
  {
    headers: {
      apikey: SUPABASE_KEY,
      Authorization: `Bearer ${SUPABASE_KEY}`,
    },
  }
);

const stats = await res.json();
    if (!Array.isArray(stats) || stats.length === 0) {
  statsPage.innerHTML = `
    <div style="padding:40px 20px;text-align:center;opacity:.7">
      <div style="font-size:48px;margin-bottom:16px">üìä</div>
      <h3>–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
      <p>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤—ã—Ö –ø–æ—Å–µ—â–µ–Ω–∏–π</p>
    </div>
  `;
  return;
    }

// –°—á–∏—Ç–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–µ—â–µ–Ω–∏–π
const totalVisits = stats.reduce((sum, d) => sum + (d.visits || 0), 0);
// üìÖ –ø–æ—Å–µ—â–µ–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
const monthVisits = stats
  .filter(d => {
    const day = new Date(d.day);
    const diff = (Date.now() - day.getTime()) / (1000 * 60 * 60 * 24);
    return diff <= STATS_DAYS;
  })
  .reduce((sum, d) => sum + (d.visits || 0), 0);
    
    statsPage.innerHTML = `
  <div style="padding:16px">
    <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>

    <div style="
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:16px;
      margin-top:20px
    ">
      <div style="
        background:#141a2b;
        border-radius:18px;
        padding:20px;
        text-align:center
      ">
        <div style="font-size:36px;font-weight:700;color:#00e5ff">
          ${totalVisits}
        </div>
        <div style="opacity:.7;margin-top:8px">
          –í—Å–µ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏–π
        </div>
      </div>

      <div style="
        background:#141a2b;
        border-radius:18px;
        padding:20px;
        text-align:center
      ">
        <div style="font-size:36px;font-weight:700;color:#00e5ff">
          ${monthVisits}
        </div>
        <div style="opacity:.7;margin-top:8px">
          –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
        </div>
      </div>
    </div>

    <canvas id="visitsChart" height="180" style="margin-top:32px"></canvas>
  </div>
`;
    drawVisitsChart(stats);
  } catch (err) {
    statsPage.innerHTML = `
      <div style="padding:40px 20px;text-align:center;opacity:.7">
        <div style="font-size:48px;margin-bottom:16px">‚ö†Ô∏è</div>
        <h3>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</h3>
      </div>
    `;
  }
  
  setActiveBottomTab("stats");
}

// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
function setActiveBottomTab(tab) {
  document.getElementById("tabClubs").classList.toggle("active", tab === "clubs");
  document.getElementById("tabFavs").classList.toggle("active", tab === "favorites");
  const statsBtn = document.getElementById("tabStats");
  if (statsBtn) {
    statsBtn.classList.toggle("active", tab === "stats");
  }
}
    // üëë –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—É (–ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM)
window.addEventListener("load", () => {
  if (tg?.initDataUnsafe?.user?.id === ADMIN_TELEGRAM_ID) {
    const statsBtn = document.getElementById("tabStats");
    if (statsBtn) {
      statsBtn.style.display = "block";
    }
  }
});
    function drawVisitsChart(stats) {
  const canvas = document.getElementById("visitsChart");
  if (!canvas) return;

  const ctx = canvas.getContext("2d");
  const width = canvas.width = canvas.offsetWidth;
  const height = canvas.height;

  ctx.clearRect(0, 0, width, height);

  const data = stats
  .slice()
  .reverse()
  .slice(-STATS_DAYS);

  const max = Math.max(...data.map(d => d.visits), 1);
  const padding = 20;

  ctx.strokeStyle = "#00e5ff";
  ctx.lineWidth = 3;
  ctx.beginPath();

  data.forEach((d, i) => {
    if (data.length === 1) {
  // —Ä–∏—Å—É–µ–º –æ–¥–Ω—É —Ç–æ—á–∫—É –ø–æ —Ü–µ–Ω—Ç—Ä—É
  const d = data[0];
  const x = width / 2;
  const y = height - padding;
  ctx.beginPath();
  ctx.arc(x, y, 4, 0, Math.PI * 2);
  ctx.fill();
  return;
    }
    const x = padding + (i / (data.length - 1)) * (width - padding * 2);
    const y = height - padding - (d.visits / max) * (height - padding * 2);
    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
  });

  ctx.lineJoin = "round";
ctx.lineCap = "round";
  ctx.stroke();

  // —Ç–æ—á–∫–∏
  ctx.fillStyle = "#00e5ff";
  data.forEach((d, i) => {
    const x = padding + (i / (data.length - 1)) * (width - padding * 2);
    const y = height - padding - (d.visits / max) * (height - padding * 2);
    ctx.beginPath();
    ctx.arc(x, y, 4, 0, Math.PI * 2);
    ctx.fill();
  });
    }
    document.addEventListener("click", function (e) {
  const heart = e.target.closest(".fav-heart");
  if (!heart) return;
  toggleFavorite(heart.dataset.id);
});
  </script>
  
  <div id="bottomNav">
  <button id="tabClubs" class="nav-btn active" onclick="showClubsTab()">
    üñ• –ö–ª—É–±—ã
  </button>
  <button id="tabFavs" class="nav-btn" onclick="showFavoritesTab()">
    ‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
  </button>
  <button id="tabStats" class="nav-btn" onclick="showStatsTab()" style="display:none">
    üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  </button>
  </div>

  <!-- Fullscreen image viewer -->
<div id="imageViewer" onclick="closeImage()" style="
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
">
  <img id="viewerImg" style="
    max-width:95%;
    max-height:95%;
    border-radius:16px;
  ">
</div>
</body>
</html>
